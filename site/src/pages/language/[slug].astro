---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { SITE } from "../../lib/siteConfig";
import LanguageFacts from "../../components/LanguageFacts.astro";
import LocatorMap from "../../components/LocatorMap.astro";
import TimelineBar from "../../components/TimelineBar.astro";

export async function getStaticPaths() {
  const entries = await getCollection("languages");
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const contributeUrl = `/contribute/?lang=${encodeURIComponent(entry.slug)}`;

const hasContext =
  !!entry.data.blurb ||
  !!entry.data.family ||
  !!entry.data.branch ||
  !!entry.data.region ||
  !!entry.data.period ||
  !!entry.data.geo ||
  (entry.data.tags?.length ?? 0) > 0;
---
<BaseLayout title={`LexiAtlas — ${entry.data.title}`}>
  <div class="card">
    <article class="prose">
      <p class="muted" style="margin:0 0 10px">
        <a href="/">← Browse</a>
      </p>
      <h1 style="margin-top:0">{entry.data.title}</h1>
      {(entry.data.aka?.length ?? 0) > 0 ? (
        <p class="muted" style="margin-top:-6px">
          Also known as: {entry.data.aka?.join(", ")}
        </p>
      ) : null}
      {entry.data.blurb ? <p class="lead">{entry.data.blurb}</p> : null}

      {hasContext ? (
        <section class="context-block" aria-label="At a glance">
          <div class="context-grid">
            <div>
              <LanguageFacts
                family={entry.data.family}
                branch={entry.data.branch}
                region={entry.data.region}
                period={entry.data.period}
                tags={entry.data.tags}
              />
              <TimelineBar period={entry.data.period} />
            </div>
            <div>
              <LocatorMap geo={entry.data.geo} title={`Approximate modern reference for ${entry.data.title}`} />
            </div>
          </div>
        </section>
      ) : null}

      <div class="muted" style="margin-top:-2px; font-size:0.95rem">
        <p style="margin:0 0 6px">
          <strong>Link legend</strong>: links marked “(archived)” open an Internet Archive snapshot because the original site is
          down or unreliable.
        </p>
        <p style="margin:0">
          See a dead/outdated resource link? <a href={contributeUrl}>Suggest a link update</a>.
        </p>
      </div>
      <Content />
      <hr />
      <p class="muted" style="margin:0">
        Noticed a problem? Use <a href={contributeUrl}>Contribute</a> or see <a href="/about/">About</a>.
      </p>
    </article>
  </div>
</BaseLayout>

